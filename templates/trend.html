<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Biểu đồ trend pH</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
  <div class="container d-flex justify-content-between align-items-center">
    <img src="{{ url_for('static', filename='logo_bsr.jpg') }}" height="40">
    <span class="navbar-brand mx-auto fs-4">PH Predictor</span>
    <img src="{{ url_for('static', filename='logo_inspection.png') }}" height="40">
  </div>
  <div class="container mt-2">
    <div class="navbar-nav mx-auto text-center">
      <a class="nav-link" href="/">🏠 Trang chủ</a>
      <a class="nav-link" href="/predict_single">📥 Dự đoán 1 lần</a>
      <a class="nav-link" href="/trend">📈 Dự đoán theo ngày</a>
    </div>
  </div>
</nav>

<div class="container py-4">
  <h2 class="text-center mb-4">📈 Biểu đồ trend pH theo ngày</h2>
  <canvas id="phTrendChart" height="100"></canvas>
  <div class="mt-5">
    <h4>Bảng dữ liệu dự đoán</h4>
    <table class="table table-bordered table-striped">
      <thead><tr><th>Ngày</th><th>pH dự đoán</th></tr></thead>
      <tbody>
        {% for row in trend_data %}
        <tr><td>{{ row.date }}</td><td>{{ row.ph }}</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="text-center mt-4">
      <a href="/trend" class="btn btn-secondary">🔁 Dự đoán lại</a>
      <a href="/" class="btn btn-primary">🏠 Trang chủ</a>
    </div>
  </div>
</div>

<script>
const labels = {{ trend_data | map(attribute='date') | list | tojson }};
const data = {{ trend_data | map(attribute='ph') | list | tojson }};
new Chart(document.getElementById('phTrendChart').getContext('2d'), {
  type: 'line',
  data: {
    labels: labels,
    datasets: [{
      label: 'pH dự đoán',
      data: data,
      borderColor: 'rgb(75, 192, 192)',
      tension: 0.3
    }]
  },
  options: {
    responsive: true,
    scales: {
      y: { beginAtZero: true, title: { display: true, text: 'pH' }},
      x: { title: { display: true, text: 'Ngày' }}
    }
  }
});
</script>
</body>
</html>
